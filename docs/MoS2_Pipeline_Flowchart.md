# MoSâ‚‚ Ultra-Sensitive Analysis Pipeline - Visual Flowcharts

## Table of Contents
1. [Complete Pipeline Overview](#complete-pipeline-overview)
2. [Stage 1: Detailed Flake Detection Flow](#stage-1-detailed-flake-detection-flow)
3. [Stage 2: Four-Method Detection Flow](#stage-2-four-method-detection-flow)
4. [Stage 3: Twist Angle Calculation Flow](#stage-3-twist-angle-calculation-flow)
5. [Decision Tree Flowchart](#decision-tree-flowchart)
6. [Parameter Impact Flow](#parameter-impact-flow)
7. [Error Handling Flow](#error-handling-flow)

---

## Complete Pipeline Overview

```
                    ğŸ”¬ INPUT: Optical Microscopy Image
                         (Twisted Bilayer MoSâ‚‚)
                                    â”‚
                                    â–¼
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘                  INITIALIZATION & SETUP                         â•‘
    â•‘  â€¢ Load UltraSensitiveMoS2Pipeline class                       â•‘
    â•‘  â€¢ Set ultra-aggressive parameters                              â•‘
    â•‘  â€¢ Create output directories                                     â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â–¼
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘                     STAGE 1: FLAKE DETECTION                    â•‘
    â•‘                                                                  â•‘
    â•‘  Input: Raw microscopy image                                     â•‘
    â•‘  Process: Morphological analysis + shape validation             â•‘
    â•‘  Output: N candidate flakes                                      â•‘
    â•‘  Success Rate: ~95% of visible flakes                          â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â–¼
                        ğŸ“Š STAGE 1 RESULTS
                      Found N flakes â†’ Continue?
                                    â”‚
                              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                              â”‚           â”‚
                         Yes  â–¼           â–¼  No
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—     âš ï¸ STOP
                    â•‘   CONTINUE   â•‘   Adjust parameters
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              â”‚
                              â–¼
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘              STAGE 2: ULTRA-SENSITIVE MULTILAYER DETECTION      â•‘
    â•‘                                                                  â•‘
    â•‘                    â”Œâ”€â”€â”€ FOR EACH FLAKE â”€â”€â”€â”                    â•‘
    â•‘                    â”‚                       â”‚                     â•‘
    â•‘            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”              â•‘
    â•‘            â”‚    METHOD     â”‚        â”‚   METHOD    â”‚              â•‘
    â•‘            â”‚      1        â”‚        â”‚     2       â”‚              â•‘
    â•‘            â”‚ Ultra-Edge    â”‚        â”‚ Ultra-Int   â”‚              â•‘
    â•‘            â”‚ Detection     â”‚        â”‚ Analysis    â”‚              â•‘
    â•‘            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â•‘
    â•‘                    â”‚                       â”‚                     â•‘
    â•‘            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”              â•‘
    â•‘            â”‚    METHOD     â”‚        â”‚   METHOD    â”‚              â•‘
    â•‘            â”‚      3        â”‚        â”‚     4       â”‚              â•‘
    â•‘            â”‚  Hierarchy    â”‚        â”‚  Template   â”‚              â•‘
    â•‘            â”‚  Analysis     â”‚        â”‚  Matching   â”‚              â•‘
    â•‘            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â•‘
    â•‘                    â”‚                       â”‚                     â•‘
    â•‘                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â•‘
    â•‘                            â–¼                                     â•‘
    â•‘                  COMBINE & DEDUPLICATE                          â•‘
    â•‘                                                                  â•‘
    â•‘  Target: 10+ multilayer flakes                                  â•‘
    â•‘  Current Success: 100% (26/26)                                  â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â–¼
                        ğŸ“Š STAGE 2 RESULTS
              Found M multilayer flakes â†’ Target Met?
                                    â”‚
                              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                              â”‚           â”‚
                       Yes (â‰¥10) â–¼         â–¼  No (<10)
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—     âš ï¸ CONSIDER
                    â•‘   CONTINUE   â•‘   More aggressive
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     parameters
                              â”‚
                              â–¼
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘                STAGE 3: TWIST ANGLE CALCULATION                 â•‘
    â•‘                                                                  â•‘
    â•‘  For each multilayer flake:                                     â•‘
    â•‘  â€¢ Calculate main flake orientation                             â•‘
    â•‘  â€¢ Calculate internal structure orientations                     â•‘
    â•‘  â€¢ Compute twist angles (0-60Â° range)                          â•‘
    â•‘  â€¢ Statistical analysis by detection method                      â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â–¼
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘                  VISUALIZATION & OUTPUT                         â•‘
    â•‘                                                                  â•‘
    â•‘  4-Panel Visualization:                                         â•‘
    â•‘  â€¢ Panel 1: All flakes (Green=Multi, Red=Single)              â•‘
    â•‘  â€¢ Panel 2: Method-colored internal structures                  â•‘
    â•‘  â€¢ Panel 3: Twist angles overlaid                              â•‘
    â•‘  â€¢ Panel 4: Detailed statistics                                 â•‘
    â•‘                                                                  â•‘
    â•‘  JSON Output: Comprehensive analysis data                       â•‘
    â•‘  Performance Metrics: Detection rates & effectiveness           â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â–¼
                    ğŸ“ˆ FINAL RESULTS & ANALYSIS
                              Success! ğŸ‰
```

---

## Stage 1: Detailed Flake Detection Flow

```
ğŸ”¬ RAW IMAGE INPUT
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Image Loading  â”‚
â”‚                 â”‚
â”‚ â€¢ BGR â†’ RGB     â”‚
â”‚ â€¢ Extract Gray  â”‚
â”‚ â€¢ Validate      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Binary Thresholdâ”‚
â”‚                 â”‚
â”‚ gray < 140      â”‚
â”‚ â†’ Binary mask   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Morphological   â”‚
â”‚ Cleaning        â”‚
â”‚                 â”‚
â”‚ Open(2Ã—2) â†’     â”‚
â”‚ Close(4Ã—4)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Contour         â”‚
â”‚ Detection       â”‚
â”‚                 â”‚
â”‚ RETR_EXTERNAL   â”‚
â”‚ CHAIN_APPROX    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Area Filter    â”‚   NO    â”‚                  â”‚
â”‚                 â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚  REJECT CONTOUR  â”‚
â”‚ 200 â‰¤ area      â”‚         â”‚                  â”‚
â”‚ â‰¤ 15000 px?     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ YES
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Calculate       â”‚
â”‚ Geometric       â”‚
â”‚ Properties      â”‚
â”‚                 â”‚
â”‚ â€¢ Solidity      â”‚
â”‚ â€¢ Aspect Ratio  â”‚
â”‚ â€¢ Circularity   â”‚
â”‚ â€¢ Vertices      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Shape           â”‚
â”‚ Validation      â”‚
â”‚                 â”‚
â”‚ solidity:0.3-1.0â”‚
â”‚ aspect: < 5.0   â”‚
â”‚ circular:> 0.15 â”‚
â”‚ vertices: 3-10  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Valid   â”‚   NO    â”‚                  â”‚
    â”‚ Flake?  â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚  REJECT CONTOUR  â”‚
    â”‚         â”‚         â”‚                  â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ YES
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Store Flake     â”‚
â”‚ Data            â”‚
â”‚                 â”‚
â”‚ â€¢ ID & contour  â”‚
â”‚ â€¢ Properties    â”‚
â”‚ â€¢ Centroid      â”‚
â”‚ â€¢ Bounding box  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ More    â”‚   YES   â”‚                  â”‚
    â”‚Contours?â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚  NEXT CONTOUR    â”‚
    â”‚         â”‚         â”‚                  â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ NO                    â”‚
          â–¼                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚ STAGE 1         â”‚               â”‚
â”‚ COMPLETE        â”‚               â”‚
â”‚                 â”‚               â”‚
â”‚ Output: N flakesâ”‚               â”‚
â”‚ Success: ~95%   â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
          â”‚                       â”‚
          â–¼                       â”‚
  Proceed to Stage 2 â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Stage 2: Four-Method Detection Flow

```
                            STAGE 2 INPUT
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  For Each Flake â”‚
                    â”‚  Extract ROI    â”‚
                    â”‚  (20px margin)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Create Flake    â”‚
                    â”‚ Mask & ROI      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚          PARALLEL DETECTION             â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚    â”‚    â”‚    â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”  â”‚    â”‚    â”‚
      â”‚  METHOD 1   â”‚  â”‚    â”‚    â”‚
      â”‚ Ultra-Edge  â”‚  â”‚    â”‚    â”‚
      â”‚ Detection   â”‚  â”‚    â”‚    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚    â”‚
            â”‚          â”‚    â”‚    â”‚
            â–¼          â”‚    â”‚    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚    â”‚
    â”‚ 6 Canny         â”‚â”‚    â”‚    â”‚
    â”‚ Thresholds:     â”‚â”‚    â”‚    â”‚
    â”‚ (10,30)(15,45)  â”‚â”‚    â”‚    â”‚
    â”‚ (20,60)(25,75)  â”‚â”‚    â”‚    â”‚
    â”‚ (5,25)(8,35)    â”‚â”‚    â”‚    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚    â”‚
            â”‚          â”‚    â”‚    â”‚
            â–¼          â”‚    â”‚    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚    â”‚
    â”‚ 3 Kernel Sizes: â”‚â”‚    â”‚    â”‚
    â”‚ 1Ã—1, 2Ã—2, 3Ã—3   â”‚â”‚    â”‚    â”‚
    â”‚ Morphology Ops  â”‚â”‚    â”‚    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚    â”‚
            â”‚          â”‚    â”‚    â”‚
            â–¼          â”‚    â”‚    â”‚
    ğŸ“Š Edge Structures â”‚    â”‚    â”‚
            â”‚          â”‚    â”‚    â”‚
            â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”  â”‚    â”‚
            â”‚      â”‚METHOD 2 â”‚  â”‚    â”‚
            â”‚      â”‚Ultra-Intâ”‚  â”‚    â”‚
            â”‚      â”‚Analysis â”‚  â”‚    â”‚
            â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
            â”‚          â”‚        â”‚    â”‚
            â”‚          â–¼        â”‚    â”‚
            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
            â”‚  â”‚ 6 Intensity     â”‚   â”‚    â”‚
            â”‚  â”‚ Drop Levels:    â”‚   â”‚    â”‚
            â”‚  â”‚ [2,5,8,12,18,25]â”‚   â”‚    â”‚
            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
            â”‚          â”‚             â”‚    â”‚
            â”‚          â–¼             â”‚    â”‚
            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
            â”‚  â”‚ 4 Kernel Sizes: â”‚   â”‚    â”‚
            â”‚  â”‚ 1Ã—1,2Ã—2,3Ã—3,4Ã—4 â”‚   â”‚    â”‚
            â”‚  â”‚ Per Level       â”‚   â”‚    â”‚
            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
            â”‚          â”‚             â”‚    â”‚
            â”‚          â–¼             â”‚    â”‚
            â”‚  ğŸ“Š Intensity Structures â”‚    â”‚
            â”‚          â”‚             â”‚    â”‚
            â”‚          â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”  â”‚
            â”‚          â”‚         â”‚METHOD 3 â”‚  â”‚
            â”‚          â”‚         â”‚Hierarchyâ”‚  â”‚
            â”‚          â”‚         â”‚Analysis â”‚  â”‚
            â”‚          â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            â”‚          â”‚             â”‚        â”‚
            â”‚          â”‚             â–¼        â”‚
            â”‚          â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
            â”‚          â”‚     â”‚ RETR_TREE       â”‚ â”‚
            â”‚          â”‚     â”‚ Find Parent-    â”‚ â”‚
            â”‚          â”‚     â”‚ Child Relations â”‚ â”‚
            â”‚          â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
            â”‚          â”‚             â”‚          â”‚
            â”‚          â”‚             â–¼          â”‚
            â”‚          â”‚     ğŸ“Š Nested Structures â”‚
            â”‚          â”‚             â”‚          â”‚
            â”‚          â”‚             â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”
            â”‚          â”‚             â”‚      â”‚METHOD 4 â”‚
            â”‚          â”‚             â”‚      â”‚Template â”‚
            â”‚          â”‚             â”‚      â”‚Matching â”‚
            â”‚          â”‚             â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚          â”‚             â”‚          â”‚
            â”‚          â”‚             â”‚          â–¼
            â”‚          â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚          â”‚             â”‚  â”‚ 6 Triangle      â”‚
            â”‚          â”‚             â”‚  â”‚ Template Sizes: â”‚
            â”‚          â”‚             â”‚  â”‚ [10,15,20,25,   â”‚
            â”‚          â”‚             â”‚  â”‚  30,40] pixels  â”‚
            â”‚          â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚          â”‚             â”‚          â”‚
            â”‚          â”‚             â”‚          â–¼
            â”‚          â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚          â”‚             â”‚  â”‚ Template Match  â”‚
            â”‚          â”‚             â”‚  â”‚ Threshold: 0.3  â”‚
            â”‚          â”‚             â”‚  â”‚ (Low = Sensitive)â”‚
            â”‚          â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚          â”‚             â”‚          â”‚
            â”‚          â”‚             â”‚          â–¼
            â”‚          â”‚             â”‚  ğŸ“Š Triangle Structures
            â”‚          â”‚             â”‚          â”‚
            â–¼          â–¼             â–¼          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              COMBINE ALL METHODS                â”‚
    â”‚                                                 â”‚
    â”‚ Collect structures from all 4 methods          â”‚
    â”‚ Apply ultra-liberal deduplication              â”‚
    â”‚ Keep structures with distance > 10px OR        â”‚
    â”‚ area similarity < 90%                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Validate Final  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Structures      â”‚   NO    â”‚                  â”‚
            â”‚                 â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚  SINGLE LAYER    â”‚
            â”‚ area â‰¥ 30px     â”‚         â”‚     FLAKE        â”‚
            â”‚ ratio â‰¥ 0.5%    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ YES
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ MULTILAYER      â”‚
            â”‚ FLAKE           â”‚
            â”‚                 â”‚
            â”‚ Store:          â”‚
            â”‚ â€¢ All structuresâ”‚
            â”‚ â€¢ Methods used  â”‚
            â”‚ â€¢ Confidence    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ More Flakes     â”‚   YES   â”‚                  â”‚
            â”‚ to Process?     â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚   NEXT FLAKE     â”‚
            â”‚                 â”‚         â”‚                  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ NO                        â”‚
                      â–¼                           â”‚
            STAGE 2 COMPLETE â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              Proceed to Stage 3
```

---

## Stage 3: Twist Angle Calculation Flow

```
                    STAGE 3 INPUT
                  (Multilayer Flakes)
                          â”‚
                          â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ For Each        â”‚
                â”‚ Multilayer      â”‚
                â”‚ Flake           â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Calculate Main  â”‚
                â”‚ Flake           â”‚
                â”‚ Orientation     â”‚
                â”‚                 â”‚
                â”‚ Steps:          â”‚
                â”‚ 1. Find centroidâ”‚
                â”‚ 2. Find apex    â”‚
                â”‚ 3. Calculate    â”‚
                â”‚    angle        â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Main Flake Orientation  â”‚
            â”‚ (0-360Â°)               â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ For Each Internal       â”‚
            â”‚ Structure               â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Calculate Internal      â”‚
            â”‚ Structure Orientation   â”‚
            â”‚                         â”‚
            â”‚ Same method as main:    â”‚
            â”‚ â€¢ Find centroid         â”‚
            â”‚ â€¢ Find apex vertex      â”‚
            â”‚ â€¢ arctan2(apex-centroid)â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Compute Raw             â”‚
            â”‚ Twist Angle             â”‚
            â”‚                         â”‚
            â”‚ twist = |main - internalâ”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Normalize Angle         â”‚
            â”‚                         â”‚
            â”‚ If twist > 180Â°:        â”‚
            â”‚   twist = 360Â° - twist  â”‚
            â”‚ If twist > 60Â°:         â”‚
            â”‚   twist = 120Â° - twist  â”‚
            â”‚                         â”‚
            â”‚ Result: 0-60Â° range     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Store Measurement       â”‚
            â”‚                         â”‚
            â”‚ â€¢ Twist angle           â”‚
            â”‚ â€¢ Internal area         â”‚
            â”‚ â€¢ Detection method      â”‚
            â”‚ â€¢ Confidence score      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ More Internal           â”‚   YES   â”‚                  â”‚
            â”‚ Structures?             â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚ NEXT STRUCTURE   â”‚
            â”‚                         â”‚         â”‚                  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ NO                                â”‚
                      â–¼                                   â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
            â”‚ Calculate Flake         â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ Statistics              â”‚
            â”‚                         â”‚
            â”‚ â€¢ Average twist angle   â”‚
            â”‚ â€¢ Standard deviation    â”‚
            â”‚ â€¢ Method breakdown      â”‚
            â”‚ â€¢ Confidence weighted   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ More Multilayer         â”‚   YES   â”‚                  â”‚
            â”‚ Flakes?                 â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚   NEXT FLAKE     â”‚
            â”‚                         â”‚         â”‚                  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ NO                                â”‚
                      â–¼                                   â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ Global Statistics       â”‚
            â”‚                         â”‚
            â”‚ â€¢ Total measurements    â”‚
            â”‚ â€¢ Overall mean angle    â”‚
            â”‚ â€¢ Angle distribution    â”‚
            â”‚ â€¢ Method effectiveness  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
                STAGE 3 COMPLETE
                      â”‚
                      â–¼
            Proceed to Visualization
```

---

## Decision Tree Flowchart

```
                        ğŸ”¬ START ANALYSIS
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Load Image      â”‚
                    â”‚ Set Parameters  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                          STAGE 1
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Found Flakes?   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ (Expected: >5)  â”‚   NO    â”‚ TROUBLESHOOT:   â”‚
                    â”‚                 â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚ â€¢ Check image   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â€¢ Adjust thresh â”‚
                              â”‚ YES             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
                          STAGE 2
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Multilayer Rate â”‚
                    â”‚ â‰¥ 30%?          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              NO    â–¼                   â–¼  YES
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ PARAMETER TUNINGâ”‚   â”‚   CONTINUE      â”‚
        â”‚                 â”‚   â”‚   TO STAGE 3    â”‚
        â”‚ Try:            â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ â€¢ Lower min_areaâ”‚             â”‚
        â”‚ â€¢ More intensityâ”‚             â–¼
        â”‚ â€¢ Add methods   â”‚         STAGE 3
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
                  â”‚                     â–¼
                  â–¼               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ Angle Results   â”‚
        â”‚ Retry Stage 2   â”‚       â”‚ Reasonable?     â”‚
        â”‚                 â”‚       â”‚ (10-70Â°)        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                         â”‚
                  â–¼                         â”‚
        Success? â†’ Continue           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
        Failure? â†’ Manual Review   NO â–¼           â–¼  YES
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                â”‚CHECK SHAPES â”‚   â”‚
                                â”‚â€¢ Non-triangleâ”‚   â”‚
                                â”‚â€¢ Poor detect â”‚   â”‚
                                â”‚â€¢ Noise      â”‚   â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                        â”‚         â”‚
                                        â–¼         â–¼
                                   FIX & RETRY  SUCCESS!
                                        â”‚         â”‚
                                        â–¼         â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    FINAL OUTPUT         â”‚
                              â”‚                         â”‚
                              â”‚ â€¢ 4-Panel Visualization â”‚
                              â”‚ â€¢ JSON Results          â”‚
                              â”‚ â€¢ Performance Metrics   â”‚
                              â”‚ â€¢ Method Analysis       â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Parameter Impact Flow

```
                        PARAMETER SENSITIVITY ANALYSIS
                                      â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                           â”‚                           â”‚
          â–¼                           â–¼                           â–¼
    CONSERVATIVE                  CURRENT                   HYPER-SENSITIVE
    PARAMETERS                 (ULTRA-SENS)                  PARAMETERS
          â”‚                           â”‚                           â”‚
          â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚min_area_ratio:  â”‚         â”‚min_area_ratio:  â”‚         â”‚min_area_ratio:  â”‚
â”‚2% (0.02)        â”‚         â”‚0.5% (0.005)     â”‚         â”‚0.2% (0.002)     â”‚
â”‚                 â”‚         â”‚                 â”‚         â”‚                 â”‚
â”‚min_internal_areaâ”‚         â”‚min_internal_areaâ”‚         â”‚min_internal_areaâ”‚
â”‚80 pixels        â”‚         â”‚30 pixels        â”‚         â”‚20 pixels        â”‚
â”‚                 â”‚         â”‚                 â”‚         â”‚                 â”‚
â”‚intensity_drops: â”‚         â”‚intensity_drops: â”‚         â”‚intensity_drops: â”‚
â”‚[5,10,15]        â”‚         â”‚[2,5,8,12,18,25] â”‚         â”‚[1,2,4,6,8,10,   â”‚
â”‚                 â”‚         â”‚                 â”‚         â”‚ 15,20,30]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                           â”‚                           â”‚
          â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚TYPICAL RESULTS: â”‚         â”‚TYPICAL RESULTS: â”‚         â”‚TYPICAL RESULTS: â”‚
â”‚                 â”‚         â”‚                 â”‚         â”‚                 â”‚
â”‚â€¢ 5-15% detectionâ”‚         â”‚â€¢ 80-100% detect â”‚         â”‚â€¢ ~100% detectionâ”‚
â”‚â€¢ Few false pos  â”‚         â”‚â€¢ Balanced       â”‚         â”‚â€¢ Many false pos â”‚
â”‚â€¢ High precision â”‚         â”‚â€¢ High recall    â”‚         â”‚â€¢ Lower precisionâ”‚
â”‚â€¢ Miss subtle    â”‚         â”‚â€¢ Good balance   â”‚         â”‚â€¢ Catch everythingâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                           â”‚                           â”‚
          â–¼                           â–¼                           â–¼
     WHEN TO USE:                WHEN TO USE:                WHEN TO USE:
                                                            
â€¢ High quality images           â€¢ Standard analysis         â€¢ Poor quality images
â€¢ Low noise                     â€¢ Balanced accuracy         â€¢ Noisy samples  
â€¢ Manual verification          â€¢ Automated pipeline         â€¢ Research/discovery
â€¢ Publication ready            â€¢ Production use             â€¢ Maximum coverage
```

---

## Error Handling Flow

```
                        ANALYSIS START
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Try Image Load  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Success?        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              NO    â–¼                   â–¼  YES
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ERROR HANDLING: â”‚      â”‚   CONTINUE      â”‚
        â”‚ â€¢ Check path    â”‚      â”‚   STAGE 1       â”‚
        â”‚ â€¢ File format   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ â€¢ Permissions   â”‚                â”‚
        â”‚ RETURN: Error   â”‚                â–¼
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ Try Contour Ops â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ Contour Error?  â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          NO    â–¼                   â–¼  YES
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   CONTINUE      â”‚    â”‚ ERROR HANDLING: â”‚
                    â”‚   STAGE 2       â”‚    â”‚ â€¢ Empty contoursâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â€¢ Shape errors  â”‚
                              â”‚            â”‚ â€¢ Use safe_     â”‚
                              â–¼            â”‚   contour_adjustâ”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ CONTINUE: Yes   â”‚
                    â”‚ Try Detection   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ Methods         â”‚              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                              â”‚                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”              â”‚
                    â”‚ Method Error?   â”‚              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                              â”‚                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
              NO    â–¼                   â–¼  YES       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚   CONTINUE      â”‚    â”‚ ERROR HANDLING: â”‚   â”‚
        â”‚   STAGE 3       â”‚    â”‚ â€¢ Skip method   â”‚   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â€¢ Log error     â”‚   â”‚
                  â”‚            â”‚ â€¢ Continue with â”‚   â”‚
                  â–¼            â”‚   other methods â”‚   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ CONTINUE: Yes   â”‚   â”‚
        â”‚ Try Angle Calc  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚           â”‚
                  â”‚                      â”‚           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”              â”‚           â”‚
        â”‚ Angle Error?    â”‚              â”‚           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚           â”‚
                  â”‚                      â”‚           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚           â”‚
    NO  â–¼                   â–¼  YES       â”‚           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚
â”‚    SUCCESS      â”‚  â”‚ ERROR HANDLING: â”‚ â”‚           â”‚
â”‚  Generate       â”‚  â”‚ â€¢ Skip angles   â”‚ â”‚           â”‚
â”‚  Full Results   â”‚  â”‚ â€¢ Report issue  â”‚ â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â€¢ Partial resultsâ”‚ â”‚          â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚
                               â”‚         â”‚           â”‚
                               â–¼         â–¼           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         FINAL RESULT                â”‚
                    â”‚                                     â”‚
                    â”‚ â€¢ Success: Full analysis            â”‚
                    â”‚ â€¢ Partial: Some errors occurred     â”‚
                    â”‚ â€¢ Failure: Critical error           â”‚
                    â”‚                                     â”‚
                    â”‚ Error Log: Details for debugging    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Method Effectiveness Comparison

```
                    DETECTION METHOD COMPARISON
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   METHOD 1    â”‚    â”‚   METHOD 2    â”‚    â”‚   METHOD 3    â”‚
â”‚ Ultra-Edge    â”‚    â”‚ Ultra-Int     â”‚    â”‚ Hierarchy     â”‚
â”‚ Detection     â”‚    â”‚ Analysis      â”‚    â”‚ Analysis      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚STRENGTHS:     â”‚    â”‚STRENGTHS:     â”‚    â”‚STRENGTHS:     â”‚
â”‚â€¢ Sharp edges  â”‚    â”‚â€¢ Subtle diffs â”‚    â”‚â€¢ Natural nest â”‚
â”‚â€¢ High precisionâ”‚    â”‚â€¢ Layer thick  â”‚    â”‚â€¢ Clean shapes â”‚
â”‚â€¢ Fast         â”‚    â”‚â€¢ Robust       â”‚    â”‚â€¢ High quality â”‚
â”‚               â”‚    â”‚               â”‚    â”‚               â”‚
â”‚WEAKNESSES:    â”‚    â”‚WEAKNESSES:    â”‚    â”‚WEAKNESSES:    â”‚
â”‚â€¢ Noise sensitiveâ”‚   â”‚â€¢ Parameter    â”‚    â”‚â€¢ Limited to   â”‚
â”‚â€¢ Miss gradual â”‚    â”‚  dependent    â”‚    â”‚  clear nestingâ”‚
â”‚  boundaries   â”‚    â”‚â€¢ Computation  â”‚    â”‚â€¢ Lower yield  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚EFFECTIVENESS: â”‚    â”‚EFFECTIVENESS: â”‚    â”‚EFFECTIVENESS: â”‚
â”‚~200/713 (28%) â”‚    â”‚~300/713 (42%) â”‚    â”‚~150/713 (21%) â”‚
â”‚HIGH           â”‚    â”‚VERY HIGH      â”‚    â”‚MEDIUM         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            METHOD 4                     â”‚
        â”‚         Template Matching               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚STRENGTHS:     â”‚
                  â”‚â€¢ Shape specificâ”‚
                  â”‚â€¢ Triangle bias â”‚
                  â”‚â€¢ Clean results â”‚
                  â”‚               â”‚
                  â”‚WEAKNESSES:    â”‚
                  â”‚â€¢ Template limitedâ”‚
                  â”‚â€¢ Size dependentâ”‚
                  â”‚â€¢ Lower coverageâ”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚EFFECTIVENESS: â”‚
                  â”‚~63/713 (9%)   â”‚
                  â”‚LOW-MEDIUM     â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚     COMBINED RESULT     â”‚
              â”‚                         â”‚
              â”‚ Total: 713 structures   â”‚
              â”‚ Success: 100% detection â”‚
              â”‚ Methods complement      â”‚
              â”‚ each other perfectly    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This comprehensive flowchart documentation provides visual understanding of your ultra-sensitive MoSâ‚‚ analysis pipeline, making it easier to understand the complex multi-method approach and troubleshoot any issues.